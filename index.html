<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Toponym Converter</title>
  <link rel="stylesheet" href="style.css" />
  <script src="script.js" defer></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      color: #333;
      padding: 2rem;
    }
    .container {
      max-width: 600px;
      margin: auto;
      padding: 2rem;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
    input, select, button {
      display: block;
      width: 100%;
      margin: 0.75rem 0;
      padding: 0.6rem;
      font-size: 1rem;
    }
    #result {
      margin-top: 1.5rem;
      font-weight: bold;
      font-size: 1.2rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Toponym Converter</h1>

    <label for="inputToponym">Enter Toponym:</label>
    <input type="text" id="inputToponym" placeholder="e.g., Roubaix" />

    <label for="mode">Conversion Mode:</label>
    <select id="mode">
      <option value="translate">Translate</option>
      <option value="phonetic">Phonetic Adaptation</option>
    </select>

    <label for="targetLang">Target Language:</label>
    <select id="targetLang">
      <option value="en">English</option>
      <option value="fr">French</option>
      <option value="de">German</option>
      <option value="pt">Portuguese</option>
      <option value="nl">Dutch</option>
    </select>

    <button id="convertButton">Convert</button>

    <div id="result"></div>
  </div>

  <script>
    function convertToponym() {
      const input = document.getElementById("inputToponym").value.trim();
      const mode = document.getElementById("mode").value;
      const lang = document.getElementById("targetLang").value;
      const resultDiv = document.getElementById("result");

      if (!input) {
        resultDiv.innerText = "Please enter a toponym.";
        return;
      }

      let result;

      if (mode === "translate") {
        result = advancedExonymResolution(input, lang);
      } else if (mode === "phonetic") {
        result = advancedPhoneticAdaptation(input, lang);
      } else {
        result = "Unknown mode.";
      }

      const ipa = mockIPA(result, lang);
      resultDiv.innerHTML = `<strong>${result}</strong><br><em>IPA:</em> ${ipa}`;
    }

    // Translation with hierarchical exonym lookup & fallback
    function advancedExonymResolution(name, lang) {
      const exonyms = {
        "München": { en: "Munich", fr: "Munich", pt: "Munique", nl: "München", de: "München" },
        "Lisboa": { en: "Lisbon", fr: "Lisbienne", de: "Lissabon", nl: "Lissabon", pt: "Lisboa" },
        "Wien": { en: "Vienna", fr: "Vienne", de: "Wien", pt: "Viena", nl: "Wenen" }
      };

      const entry = exonyms[name];
      if (entry && entry[lang]) {
        return entry[lang];
      }

      // Fallback: append language-specific suffix
      const suffixMap = {
        de: "burg",
        fr: "ville",
        pt: "cidade",
        nl: "dam",
        en: "town"
      };
      const suffix = suffixMap[lang] || "town";
      return name.charAt(0).toUpperCase() + name.slice(1).toLowerCase() + suffix;
    }

    // Phonetic adaptation rules per language
    function advancedPhoneticAdaptation(name, lang) {
      let phonetic = name.toLowerCase();

      const rulesByLang = {
        de: [
          [/gn/g, 'n'],
          [/ou/g, 'au'],
          [/ai/g, 'ei'],
          [/x/g, 'chs'],
          [/c(?=[eéií])/g, 'z'],
          [/c/g, 'k'],
          [/qu/g, 'kw'],
          [/ph/g, 'f'],
          [/y/g, 'ü'],
          [/e$/g, 'en'],
          [/^bo/g, 'boll'],
          [/([aeiou])s$/g, '$1s'],
          [/([aeiou])s([aeiou])/g, '$1z$2'],
          [/([aeiou])ss([aeiou])/g, '$1ß$2'],
          [/ss$/g, 'ß']
        ],
        fr: [
          [/k/g, 'qu'],
          [/w/g, 'ou'],
          [/sh/g, 'ch'],
          [/z/g, 's'],
          [/c(?=[eéií])/g, 's'],
          [/c/g, 'k'],
          [/qu/g, 'k'],
          [/ph/g, 'f'],
          [/y/g, 'i'],
          [/j/g, 'j'],
          [/([aeiou])s$/g, '$1s'],
          [/([aeiou])s([aeiou])/g, '$1z$2'],
          [/([aeiou])ss([aeiou])/g, '$1s$2'],
          [/ss$/g, 's']
        ],
        pt: [
          [/j/g, 'j'],
          [/sh/g, 'ch'],
          [/w/g, 'u'],
          [/c(?=[eéií])/g, 's'],
          [/c/g, 'k'],
          [/qu/g, 'kw'],
          [/ph/g, 'f'],
          [/y/g, 'i'],
          [/([aeiou])s$/g, '$1s'],
          [/([aeiou])s([aeiou])/g, '$1z$2'],
          [/([aeiou])ss([aeiou])/g, '$1s$2'],
          [/ss$/g, 's']
        ],
        nl: [
          [/sh/g, 'sch'],
          [/ou/g, 'oe'],
          [/w/g, 'w'],
          [/ch/g, 'g'],
          [/c(?=[eéií])/g, 's'],
          [/c/g, 'k'],
          [/qu/g, 'kw'],
          [/ph/g, 'f'],
          [/y/g, 'i'],
          [/([aeiou])s$/g, '$1s'],
          [/([aeiou])s([aeiou])/g, '$1z$2'],
          [/([aeiou])ss([aeiou])/g, '$1s$2'],
          [/ss$/g, 's']
        ],
        en: [
          [/ü/g, 'u'],
          [/ö/g, 'oe'],
          [/ä/g, 'ae'],
          [/ß/g, 'ss'],
          [/ch/g, 'k'],
          [/c(?=[eéií])/g, 's'],
          [/c/g, 'k'],
          [/qu/g, 'kw'],
          [/ph/g, 'f'],
          [/y/g, 'i'],
          [/([aeiou])s$/g, '$1s'],
          [/([aeiou])s([aeiou])/g, '$1z$2'],
          [/([aeiou])ss([aeiou])/g, '$1s$2'],
          [/ss$/g, 's']
        ]
      };

      const langRules = rulesByLang[lang] || [];
      langRules.forEach(([pattern, replacement]) => {
        phonetic = phonetic.replace(pattern, replacement);
      });

      return phonetic.charAt(0).toUpperCase() + phonetic.slice(1);
    }

    // Simple IPA mockup for fun
    function mockIPA(name, lang) {
      const ipaMap = {
        de: name
          .replace(/ch/g, 'x')
          .replace(/ei/g, 'aɪ')
          .replace(/ie/g, 'iː')
          .replace(/au/g, 'aʊ')
          .replace(/z/g, 'ts')
          .replace(/w/g, 'v'),
        fr: name
          .replace(/ch/g, 'ʃ')
          .replace(/ou/g, 'u')
          .replace(/ill/g, 'ij')
          .replace(/gn/g, 'ɲ'),
        pt: name
          .replace(/ão/g, 'ɐ̃w̃')
          .replace(/nh/g, 'ɲ')
          .replace(/lh/g, 'ʎ')
          .replace(/rr/g, 'ʁ'),
        nl: name
          .replace(/oe/g, 'u')
          .replace(/ui/g, 'œy')
          .replace(/sch/g, 'sx')
          .replace(/ij/g, 'ɛi'),
        en: name
          .replace(/th/g, 'θ')
          .replace(/sh/g, 'ʃ')
          .replace(/ph/g, 'f')
          .replace(/ough/g, 'ʌf')
      };

      const ipa = ipaMap[lang] || name;
      return `/${ipa.toLowerCase()}/`;
    };

    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("convertButton").addEventListener("click", convertToponym);
    });
  </script>
</body>
</html>
